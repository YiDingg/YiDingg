# Virtuoso Tutorials - 16. Using CALIBREVIEW + Config Sweep to Speed Up Your Post-Layout Simulation

> [!Note|style:callout|label:Infor]
> Initially published by YiDingg at 00:54 on 2025-10-28 in Beijing.

## Background


## 1. Why Config Sweep?

Config Sweep 是 Cadence Virtuoso ADE Assembler 中的一个功能，允许用户在同一次仿真中扫描多个配置视图 (config views)，从而实现对不同设计版本或不同仿真条件下的性能进行对比分析。结合 CALIBREVIEW 格式导出的 calibre 视图，可以大大加快后仿效率，避免重复设置/运行仿真。光说不练假把式，下面通过具体的例子来感受 Config Sweep 的优势。


### 1.1 config sweep demo

推荐的项目文件结构如下：
``` bash
- (cell) Testbench_VCO  # The top-level testbench cell for pre-layout and post-layout simulation of VCO
    - (view) schematic  # The schematic of the testbench, which instantiates RVCO1/RVCO2 as its sub-cells
    - (view) config     # The configuration of the testbench, which uses Testbench_VCO > schematic as its binding view
- (cell) RVCO1
    - (view) schematic  # The schematic of the RVCO1
    - (view) layout     # The layout of the RVCO1
    - (view) symbol     # The symbol of the RVCO1
    - (view) calibre    # The calibre view of the RVCO1, generated by Calibre PEX with CALIBREVIEW as the output format
- (cell) RVCO2
    - (view) schematic  # The schematic of the RVCO2
    - (view) layout     # The layout of the RVCO2
    - (view) symbol     # The symbol of the RVCO2
    - (view) calibre    # The calibre view of the RVCO2, generated by Calibre PEX with CALIBREVIEW as the output format
```

假设现在我们需要分别对 RVCO1/RVCO2 进行前仿和后仿 (一共四组仿真)，最直接也是最普通 (但是比较麻烦) 的方法是：
- (1) 在 `Testbench_VCO > schematic` 中，放置 `RVCO1 > symbol` 作为待测模块 (DUT, device under test)，并在 `Testbench_VCO > config` 中指定 RVCO1 使用 schematic (前仿) 视图，运行仿真，得到 RVCO1 的前仿结果；
- (2) 在 (1) 的基础上，将 `Testbench_VCO > config` 中 RVCO1 的绑定视图改为 calibre (后仿) 视图，运行仿真，得到 RVCO1 后仿结果；
- (3) 对于 RVCO2, 同理，重复 (1)(2) 步骤，得到 RVCO2 的前仿和后仿结果。
- 总结：一共需要进行四次 "设置 + 仿真" 操作，不但操作过于繁琐，容易出错，还不方便结果对比，因为四次仿真的结果被分开保存在四个 history 中。


如果使用 Config Sweep 功能，则可以大大简化上述操作流程，先将 RVCO1/RVCO2 的 `schematic` 和 `calibre` 视图都复制到一个新的 cell 中 (例如命名为 RVCO_configSweep)：

``` bash
- (cell) RVCO_configSweep
    - (view) symbol           # Symbol for RVCO_ConfigSweep, which is the same as RVCO1/RVCO2 symbol
    - (view) RVCO1_schematic  # Copy of RVCO1 > schematic
    - (view) RVCO1_calibre    # Copy of RVCO1 > calibre
    - (view) RVCO2_schematic  # Copy of RVCO2 > schematic
    - (view) RVCO2_calibre    # Copy of RVCO2 > calibre
```

此时，前面的仿真流程便可以简化为：
- (1) 在 `Testbench_VCO > schematic` 中，放置 `RVCO > symbol` 作为待测模块 (DUT, device under test)，`Testbench_VCO > config` 中无需特别指定 RVCO 的绑定视图 (schematic/calibre 都可)
- (2) 在 ADE Assembler 中，使用 Config Sweep 功能，选择 `sweep cell = RVCO_configSweep` (注意不是选择 Testbench_VCO cell)，以及 `sweep views = RVCO1_schematic, RVCO1_calibre, RVCO2_schematic, RVCO2_calibre` 四个视图作为待扫描的视图 (config views);
- (3) 运行仿真，ADE 会自动依次绑定 RVCO 的四个视图进行仿真，最终在同一个 history 中保存四组仿真结果，方便对比分析。

显然，使用 Config Sweep 功能后，只需要进行一次 "设置 + 仿真" 操作，极大地简化了操作流程，提高了工作效率。并且这种方法在大型设计项目中尤为有效，因为大型设计项目通常有多个迭代版本 (少则几个，多则几十个)，使用 config sweep 可以方便地对比不同版本的仿真结果。下面是一个例子：

<div class="center"><img src="https://imagebank-0.oss-cn-beijing.aliyuncs.com/VS-PicGo/2025-10-28-02-21-25_Virtuoso Tutorials - 16. Using Config Sweep and CALIBREVIEW to Speed Up Your Post-Layout Simulation.png"/></div>

如果再配合 Spectre X 甚至 Spectre FX 之类的高性能仿真引擎，可以进一步缩短仿真时间，为性能对比节省更多时间。这类高性能仿真引擎的使用方法可参考 


特别地，由于 config sweep variable 本质上是一种 global variable, 我们完全可以在 `corner setup > design variable` 中定义它，这会使得四组仿真结果 (在 detail 视图下) 像多个 corner 一样横向排列开来，方便对比分析。下面是一个例子：


<div class='center'>

| 性能汇总与对比 | 锁定波形图 | 电流波形图 | 电流 floor 波形 | 前后仿电流 floor 对比 |
|:-:|:-:|:-:|:-:|:-:|
 | <div class="center"><img src="https://imagebank-0.oss-cn-beijing.aliyuncs.com/VS-PicGo/2025-10-28-02-35-36_Virtuoso Tutorials - 16. Using Config Sweep and CALIBREVIEW to Speed Up Your Post-Layout Simulation.png"/></div> | <div class="center"><img src="https://imagebank-0.oss-cn-beijing.aliyuncs.com/VS-PicGo/2025-10-28-02-37-10_Virtuoso Tutorials - 16. Using Config Sweep and CALIBREVIEW to Speed Up Your Post-Layout Simulation.png"/></div> | <div class="center"><img src="https://imagebank-0.oss-cn-beijing.aliyuncs.com/VS-PicGo/2025-10-28-02-41-36_Virtuoso Tutorials - 16. Using Config Sweep and CALIBREVIEW to Speed Up Your Post-Layout Simulation.png"/></div> | <div class="center"><img src="https://imagebank-0.oss-cn-beijing.aliyuncs.com/VS-PicGo/2025-10-28-12-25-33_Virtuoso Tutorials - 16. Using Config Sweep and CALIBREVIEW to Speed Up Your Post-Layout Simulation.png"/></div> | <div class="center"><img src="https://imagebank-0.oss-cn-beijing.aliyuncs.com/VS-PicGo/2025-10-28-12-29-15_Virtuoso Tutorials - 16. Using Config Sweep and CALIBREVIEW to Speed Up Your Post-Layout Simulation.png"/></div> |
</div>



### 1.2 config sweep for multiple modules

上面介绍的是针对单个待测模块 (DUT) 进行 config sweep 的方法。如果设计中有多个待测模块，例如 Testbench 中同时包含 RVCO 和 CP (Charge Pump) 两个待测模块，也可以使用类似的方法进行：
- 方法一：在 global variable 中定义两个 config sweep variable (分别对应 RVCO 和 CP)，同时可以配合 variable set 以自定义两个模块的视图组合方式
- 方法二：不使用 global variable, 而是在 corner setup 中定义两个 design variable 并输入待扫描的视图列表，可以添加多个 corner 来定义不同的视图组合方式

具体操作方法与单模块 config sweep 类似，此处不再赘述。参考资料 [[1] Cadence Blogs > Analog/Custom Design > Virtuosity: Sweeping Multiple Config Views](https://community.cadence.com/cadence_blogs_8/b/cic/posts/sweeping-multiple-config-views) 中给出了一个具体的例子，读者可以适当参考。


## 2. Recommended File Stc.

为了更好地组织和管理工程文件，建议采用如下文件结构：

<div class='center'>

| 当前工艺库通用 library | 本次项目 library |
|:-:|:-:|
 | <div class="center"><img src="https://imagebank-0.oss-cn-beijing.aliyuncs.com/VS-PicGo/2025-10-28-02-53-50_Virtuoso Tutorials - 16. Using Config Sweep and CALIBREVIEW to Speed Up Your Post-Layout Simulation.png"/></div> | <div class="center"><img src="https://imagebank-0.oss-cn-beijing.aliyuncs.com/VS-PicGo/2025-10-28-03-29-21_Virtuoso Tutorials - 16. Using Config Sweep and CALIBREVIEW to Speed Up Your Post-Layout Simulation.png"/></div> |
</div>

## 3. Cautions for Export calibre

详见 [Virtuoso Tutorials - 15. Several Methods for PEX and How to Speed Up Your Post-Simulation](<AnalogIC/Virtuoso Tutorials - 15. Several Methods for PEX and How to Speed Up Your Post-Simulation.md>) 的 **6. Cautions for CALIBREVIEW** 一节。




## Reference

- [[1] Cadence Blogs > Analog/Custom Design > Virtuosity: Sweeping Multiple Config Views](https://community.cadence.com/cadence_blogs_8/b/cic/posts/sweeping-multiple-config-views)
- [[2] Analog-Life > Cadence maestro 快速仿真实用教程 (ADE Explorer 与 ADE Assembler)](https://www.analog-life.com/2025/02/improve-simulation-efficiency-with-cadence-maestro/)
- [[3] IC Infra > Config Sweep in ADE Assembler (Video Tutorial)](https://icinfra.cn/posts/config-sweep-in-ade-assembler/)