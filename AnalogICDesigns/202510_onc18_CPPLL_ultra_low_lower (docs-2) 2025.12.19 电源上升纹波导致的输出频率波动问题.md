# 202510_onc18_CPPLL_ultra_low_lower (docs-2) 2025.12.19 电源上升纹波导致的输出频率波动问题

> [!Note|style:callout|label:Infor]
> Initially published by YiDingg at 18:03 on 2025-12-19 in Beijing.

## 电源上升纹波导致的输出频率波动问题

### 1. 问题现象描述

在锁相环和数字电源联合仿真时，发现电源充电时纹波突变过大 (约 +60 mV)，这会使输出频率出现明显波动，然后在 180 us 内重新稳定。并且，由电源的工作原理容易知道，平均输出电流与充电纹波频率成正比，所以这个频率波动现象在重载时更为明显 (比如 enable 了引到 PAD 的两路输出时)。

具体而言，当前数字电源的工作原理是：当输出电压低于 1.25 V 时 (比如 1.235 V)，内部电路开启，给电源输出端大电容 (uF-level) 充电，直到输出电压达到 1.31 V 左右，停止充电。这个过程带来了 +50 mV ~ +70 mV 的输出电压突变，尽管我们已经使用了 VDD-referenced LPF 和 VDD-referenced VCO 来抑制电源波动对输出频率的影响，但 50 mV ~ 70 mV 的突变还是足以让输出频率出现明显波动。

下图是一个具体的例子：

<div class="center"><img src="https://imagebank-0.oss-cn-beijing.aliyuncs.com/VS-PicGo/2025-12-19-01-28-46_临时文件.png"/></div><br><br>

图中可以看到，在接入锁相环之后 (enable 了 big BUF，模拟测试时的电流消耗)，电源的充电纹波间隔缩小到 2ms, 导致输出频率每 2ms 出现一次明显波动，尽管 180 us 内能重新稳定下来，但频繁的波动为测试带来了不便。

使用 VDD-referenced LPF/VCO，是为了让锁相环中 VCO 的控制电压 "`vcont` 紧紧跟随 VDD"，使得这俩的差值基本不变，这样能充分抑制电源波动对输出频率的影响。但别忘了从 vcont 到 GND 之间的电压差也会影响 VCO 输出频率。下图是一个例子，说明了频率波动的直接原因是 "VCO 控制电压 vcont 到 GND 之间的电压差值突变过大"。毕竟 50 mV ~ 70 mV 已经较大，足以使 VCO 频率发生明显变化：

<div class="center"><img src="https://imagebank-0.oss-cn-beijing.aliyuncs.com/VS-PicGo/2025-12-19-01-31-08_临时文件.png"/></div><br><br>

最后给出每次频率波动的具体变化情况：

<div class="center"><img src="https://imagebank-0.oss-cn-beijing.aliyuncs.com/VS-PicGo/2025-12-19-01-41-03_临时文件.png"/></div><br><br>

可以看到，输出通道 `CK_OUT` (当前频率设置为 X24) 的频率在 720.9 kHz ~ 843.0 kHz 之间波动，也即 **<span style='color:red'> -8.33% ~ +7.193% </span>**，并 **<span style='color:red'> 在 180 us 内重新稳定下来 </span>**；而另一路输出 `CK_ADC` (频率固定为 X03) 的频率在 92.36 kHz ~ 104.6 kHz 之间波动，也即 **<span style='color:red'> -6.05% ~ +6.40% </span>**，同样在 180 us 内重新稳定下来。




### 2. 问题细节补充

问：电源的上升纹波是怎么来的，重载模式是什么意思？
- 答：这个数字电源，大概是根据 "`当输出电压低于 1.25 V 时 (比如 1.235 V)，内部电路开启，给电源输出端大电容 (uF-level) 充电，直到输出电压达到 1.31 V 左右，停止充电`" 的原理来工作的。那么在输出端电容不变的情况下，平均消耗电流越大，电压下降得越快，充电越频繁，纹波就越密集。

问：enable 了 big BUF 时是这样，那么 disable big BUF 时的输出频率如何？
- 答：disable 了 big BUF 时，由于整个锁相环仅消耗 465 nA 电流 (空载)，电源电压下降得非常慢，即便 TB 中多消耗了 1uA 电流 (总共 1.465 uA)，充电间隔也能维持在 60 ms 以上，这么大的间隔并不会对输出频率造成明显影响 (因为频率波动间隔远大于 180 us 的稳定时间)，也基本不会影响后级使用锁相环输出时钟的数字电路正常工作 (具体有没有影响，还需进一步确认)。
- <span style='color:red'> 注：无论有没有 enable big BUF，联合仿真下的锁相环输出性能都与单独仿真时一致 (包括功耗和抖动等)，仅是频率受电源纹波影响出现波动而已。 </span>


问：可能的解决方案有什么？
- 答：只要从 LDO 输出端消耗过多电流，这个纹波就会变密集。相反，平均消耗电流越少，纹波就越稀疏 (间隔越大)。那么只有两种方案：
    - (1) 增大 LDO 输出端电容，让每次充电能“撑住”的时间长一些，开启没那么频繁，纹波自然就变稀疏
    - (2) 把我们输出端 big BUF (用于将内部的两路输出放大到 PAD) 的电源单独拉出来，不和锁相环其它部分共用，这样测试的时候需要单独给 big BUF 供电（small BUF 仍算在锁相环剩余部分里，用于提供有一定负载能力的时钟输出）












